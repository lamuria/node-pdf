var spdy = require('./');

var keys = require('./test/fixtures').keys;

spdy.createServer({
  key: keys.key,
  cert: keys.cert,
  spdy: {
  }
}, function(req, res) {
  console.log(req.url);
  res.writeHead(200, {
    'Content-Type': 'text/html'
  });

  var push = '/' + Math.random() + '.txt';
  var stream = res.push(push, {
    request: {
    },
    response: {
      'content-type': 'application/javascript'
    }
  }, function(err, stream) {
    if (err)
      throw err;

    stream.on('error', function(err) {
      console.log(err);
    });

    stream.end('document.write("hello")');
    res.end('<script src="' + push + '"></script>');
  });
}).listen(1443, function() {
  console.log(this.address());
});
